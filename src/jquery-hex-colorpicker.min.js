(function(e){e.fn.extend({hexColorPicker:function(t){function r(e){var t=e.replace("#","").match(/.{1,2}/g);var n=parseInt(t[0],16)/255;var r=parseInt(t[1],16)/255;var i=parseInt(t[2],16)/255;var s=.3*n+.59*r+.11*i;return s>.6?"#000000":"#ffffff"}function i(t){if(e(t).children(".middle").length>0){return e(t).children(".middle").first().css("background-color")}else{return e(t).css("background-color")}}function s(){e(".hex-color-picker-wrapper").css({width:(n.pickerWidth+n.innerMargin+n.blockWidth).toString()+"px"});e(".hex-color-picker-wrapper .color-block").css({width:n.blockWidth.toString()+"px",height:n.blockWidth.toString()+"px"});e(".hex-color-picker-wrapper .color-picker-container").css({width:n.pickerWidth.toString()+"px"});e(".hex-color-picker-wrapper .picker-sidebar").css({width:n.blockWidth.toString()+"px"});e(".hex-color-picker-wrapper .picker-row").css({height:n.blockWidth.toString()+"px"});e(".hex-color-picker-wrapper .picker-form-wrapper").css({"padding-top":n.innerMargin.toString()+"px"});e(".color-picker-container .color-block").click(function(){e(".picker-sidebar").html(l(i(this)))});e(".hex-color-picker-wrapper .color-block").click(function(){var t="#"+a(i(this));e(".picker-form .selected-color").val(t);e(".picker-form .selected-color").css({"background-color":t,color:r(t)});if(n.selectCallback!==false){n.selectCallback(t)}});e(".hex-color-picker-wrapper .picker-form").submit(function(t){if(e(".picker-form .selected-color").val().length>0){var i=a(e(".picker-form .selected-color").val());var s="#"+i;var o=n.outputFormat.replace("<hexcode>",i);n.targetElem.val(o);n.targetElem.change();if(n.colorizeTarget){n.targetElem.css({"background-color":s,color:r(s)})}if(n.submitCallback!==false){n.submitCallback(i)}}t.preventDefault();e(".hex-color-picker-wrapper").remove()});if(n.style=="hex"){e(".color-picker-container .color-block").addClass("hex");e(".color-picker-container .color-block").html('<div class="top"></div><div class="middle"></div><div class="bottom"></div>');var t=Math.ceil(n.blockWidth/Math.pow(8,1/4));var s=Math.ceil(t/2);var o=Math.floor(n.blockWidth/2);e(".color-picker-container .color-block").each(function(){var r=e(this).css("background-color");e(".picker-row").css({height:"auto"});e(this).css({"margin-bottom":(-s-1).toString()+"px",height:"auto"});e(this).children(".top").css({width:0,"border-bottom":s.toString()+"px solid "+r,"border-left":o.toString()+"px solid transparent","border-right":o.toString()+"px solid transparent"});e(this).children(".middle").css({width:n.blockWidth,height:t.toString()+"px",background:r});e(this).children(".bottom").css({width:0,"border-top":s.toString()+"px solid "+r,"border-left":o.toString()+"px solid transparent","border-right":o.toString()+"px solid transparent"})});e(".color-picker-container .color-block").css("background-color","transparent");e(".hex-color-picker-wrapper .picker-sidebar .color-block").css({height:(s+t).toString()+"px"})}}function o(e){return("00"+e).slice(-2)}function u(e,t,n){return"#"+o(e.toString(16))+o(t.toString(16))+o(n.toString(16))}function a(e){function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}if(/^#[0-9A-F]{6}$/i.test(e))return e.replace("#","");e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return t(e[1])+t(e[2])+t(e[3])}function f(e,t,r){var i,s,o;var a=t%360;var f=e;var l=a/60;if(n.colorModel==="hsv"){i=r*f;s=i*(1-Math.abs(l%2-1));o=r-i}else{i=(1-Math.abs(2*r-1))*f;s=i*(1-Math.abs(l%2-1));o=r-1/2*i}var c,h,p=0;switch(Math.floor(l)){case 0:c=i;h=s;p=0;break;case 1:c=s;h=i;p=0;break;case 2:c=0;h=i;p=s;break;case 3:c=0;h=s;p=i;break;case 4:c=s;h=0;p=i;break;case 5:c=i;h=0;p=s;break}c=Math.round((c+o)*255);h=Math.round((h+o)*255);p=Math.round((p+o)*255);return u(c,h,p)}function l(t){var r;var i=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);var s=i[1]/255;var o=i[2]/255;var u=i[3]/255;var a=Math.max.apply(Math,[s,o,u]);var l=Math.min.apply(Math,[s,o,u]);var c=a-l;if(c===0){r=0}else if(a==s){r=((o-u)/c+6)%6}else if(a==o){r=(u-s)/c+2}else if(a==u){r=(s-o)/c+4}var h=r*60;var p=c;var d=1;for(var v=0;v<n.maxBlocks;v++){e(".picker-sidebar .color-block:eq("+v+")").css({"background-color":f(p,h,d)});d-=1/(n.maxBlocks-1)}}function c(){var e,t,r,i,s;var o="<div class='hex-color-picker-wrapper'>";var u=Math.floor(n.maxBlocks/2);var a=Math.sqrt(5/4)*u;o+="<div class='color-picker-container'>";for(var l=0;l<n.maxBlocks;l++){var c=n.size+l;if(l>=n.size){c=n.size*2-(l-n.size+2)}o+="<div class='picker-row'>";for(var h=0;h<c;h++){i=u-l;r=-u+(h+(n.maxBlocks-c)/2);e=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));var p=e/a;t=Math.atan(i/r)*180/Math.PI+90;if(r>=0){t+=180}if(n.colorModel=="hsv"){s=1}else{s=.5}if(p===0){t=0}o+="<div class='color-block' style='background-color:"+f(p,t,s)+"'></div>"}o+="</div>"}o+="</div>";o+='<div class="picker-sidebar">';for(l=0;l<n.maxBlocks;l++){o+="<div class='color-block'></div>"}o+="</div>";o+='<div class="picker-form-wrapper"><form class="picker-form">'+'<input type="text" name="selected-color" class="selected-color" readonly="readonly"/>'+'<input type="submit" value="OK" name="submit" class="submit"/>'+"</form></div>";o+="</div>";return o}this.defaultOptions={colorModel:"hsv",size:5,pickerWidth:200,container:"none",innerMargin:20,style:"hex",colorizeTarget:true,selectCallback:false,submitCallback:false,outputFormat:"#<hexcode>"};var n=e.extend({},this.defaultOptions,t);return this.each(function(){var t=e(this);n.blockWidth=Math.floor(n.pickerWidth/(n.size*2-1));n.maxBlocks=n.size*2-1;n.elem=e(this);t.click(function(){e(".hex-color-picker-wrapper").remove();t.after(c());s();n.targetElem=t;if(n.container=="dialog"){e(".hex-color-picker-wrapper").dialog({position:{my:"left top",at:"left bottom",of:t},resizable:false,title:"Select a Color",height:"auto",width:n.pickerWidth+n.innerMargin+n.blockWidth+40})}})})}})})(jQuery)